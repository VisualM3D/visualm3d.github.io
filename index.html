
<!doctype html>
<html>

<head>
  <title>VisualM3D</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2.0, minimum-scale=1, user-scalable=yes"/>
  <script src="js/d3.v3.min.js"></script>
  <script src="js/boarder.js"></script>
  <script src="js/scala.js"></script>
  <script src="js/calculateDataColors.js"></script>
  <script src="js/calculateMinMax.js"></script>
  <script src="js/fileLoader.js"></script>
  <style>
  input{
  	margin-left: 0px;
	margin-right: 0px;
	padding-left: 0px;
	padding-right: 0px;
  };
  </style>
</head>

<body>
	<div>
  		<input type="file" id="theFile" onchange="handleFiles(this.files)"/>	
  		<label for="max"> Max: <input type="number" id="max" onchange="redraw()"  style="width: 20%;"/> </label>
  		<label for="min"> Min: <input type="number" id="min" onchange="redraw()"  style="width: 20%;"/> </label>
  	</div>
	<div>
		<!--  Oberflaeche zum Malen der Daten -->
		<canvas id ="canvasID" width="1400" height="640" style="width: 100%;"></canvas>
	</div>

	<div>
		<!-- Slider fuer die Tiefe -->
		<input type="range" id="depthSlider" min="1" max ="15" step="1" value="1" onchange="depthChange(this)" ontouchmove="depthChange(this)" onmousemove="depthChange(this)" style="width: 91.5%;"/>  
	</div>
	<!-- Anzeige fuer die aktuelle Tiefe -->
	<canvas id="Depth" width="1280" height="30" style="width: 100%;"></canvas>

	<script>
		var dat0;
		var lsm;
		var depth=1;
		var canvas = document.getElementById('canvasID');
		var ctx= canvas.getContext('2d');
		var canvasDepth = document.getElementById('Depth');
		var canvasDepth2d = canvasDepth.getContext('2d');

		d3.text('landSeaMask.csv', function(mask){
		    lsm = d3.csv.parseRows(mask);
		    setUp();	
		});
	</script>
	
	<img id="metos" src='m3d-logo-460x460.png' style='position:absolut; width:0px; height: 0px;visibility: hidden;'>
	
	<script>    
	// Methodenblock

		// Erzeugung des Startbildschirms
		function setUp(){
	
		  document.getElementById("Depth").innerText="Tiefe: " +depth;
		  document.getElementById("depthSlider").value=depth;
		  document.getElementById("min").value="";
		  document.getElementById("max").value="";
		  document.getElementById("theFile").value="";
		  landDataColors(lsm);
		  drawLandBoarder(lsm);
	
		  var img=document.getElementById("metos");
		  ctx.drawImage(img, 410, 90);
		  doScala(3, 0);
		}

		// Bekommt einen Datensatz mit, setzt die Skala zurueck und ruft die Funktion zum Malen der Daten auf. 
		function redrawData(data){
			  	  dat0=data;
				  	document.getElementById("min").value="";
				  	document.getElementById("max").value="";
			  	  redraw();
		}
		// Loescht die alten Daten und zeichnet die neue Oberflaeche mit den neuen Daten. 	
		function redraw(){
			var min;
			// ist kein Minimum gesetzt ,wird als default Wert 0 genommen. 
			if(document.getElementById("min").value == ""){
				
				min=calculateMin(dat0);          
				if(parseFloat(min)<0){
					min=0
				}
			}else{
				min= parseFloat(document.getElementById("min").value);
			}
			var max;
			// ist kein Maximum gesetzt ,wird als default Wert 3 genommen. 
			if(document.getElementById("max").value == ""){
				
				var max=calculateMax(dat0);
			    if(!(parseFloat(max) < 3)){
			    	max=3;
			    }
			}else{
				max= parseFloat(document.getElementById("max").value);
			}
			
		    var step = 510  /(max-min); 
			ctx.fillStyle = "rgb(255,255,255)";
			ctx.fillRect(0,0,1400, canvas.height);
			calculateDataColors(dat0, lsm, step, min, depth);
			drawLandBoarder(lsm);
			doScala(max, min);
		}
 		// Empfaengt den Wert vom Slider und laesst die Oberflaeche neu malen, mit der aktuellen Tiefe. 
 		function depthChange(value){	
			depth= value.value;
			canvasDepth2d.fillStyle = "rgb(255,255,255)";
			canvasDepth2d.fillRect(0,0,1280, 30);
			canvasDepth2d.fillStyle = 'rgb(0,0,255)';
			canvasDepth2d.font="20px Georgia";
			var tiefe = "0 - 50m";
			switch(depth){
				case "1": 
					tiefe="0 - 50m";
					break;
				case "2":
					tiefe="50 - 120m";
					break;
				case "3":
					tiefe="120 - 220m";
					break;
				case "4":
					tiefe="220 - 360m";
					break;
				case "5":
					tiefe="360 - 550m";
					break;
				case "6":
					tiefe="550 - 790m";
					break;
				case "7":
					tiefe="790 - 1080m";
					break;
				case "8":
					tiefe="1080 - 1420m";
					break;
				case "9":
					tiefe="1420 - 1810m";
					break;
				case "10":
					tiefe="1810 - 2250m";
					break;
				case "11":
					tiefe="2250 - 2740m";
					break;
				case "12":
					tiefe="2740 - 3280m";
					break;
				case "13":
					tiefe="3280 - 3870m";
					break;
				case "14":
					tiefe="3870 - 4510m";
					break;
				case "15":
					tiefe="4510 - 5200m";
					break;
				default:
					break;
					
			}
			canvasDepth2d.fillText(tiefe, (canvasDepth.width* 0.915)/value.max*(depth-1) , 30);
		    redraw();
		  }
	</script>
</body>
</html>
